---
title: "Mixed Models Part 2"
author: ""
date: ""
output: 
  html_document:
    theme: flatly
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overview 

In this second workshop on mixed models we will look at how to build LMMs for factorial design, including ensuring we choose a contrast coding scheme for our experimental factors that allows us to interpret our parameter estimates appropriately. We'll also look at generalised linear mixed models (GLMMs) in the context of modelling binomial data (where our DV is a 0 or a 1), and ordinal mixed models for cases where our DV is measured on an ordinal scale (as might be the case with Likert-scale data).

&nbsp;&nbsp;

[video 1 here]

&nbsp;&nbsp;

## Slides

You can download the slides in .odp format by clicking [here](../slides/Mixed_Models_Part_2.odp) and in .pdf format by clicking on the image below. 

&nbsp;&nbsp;

<center>

[![Link to Data Visualisation slides](../images/mixed_models_pt2.png){width=75%}](../slides/Mixed_Models_Part_2.pdf)

</center>

&nbsp;&nbsp;

Once you've watched the video above, run the code below on your own machines.

## Mixed Models
### 2 x 2 Factorial Design

In this first case imagine that we have a 2 x 2 repeated measures design. The first factor is Context (Negative vs. Positive) and the second is Sentence Type (Negative vs. Positive). The DV is reading time duration to a Target Sentence (measured in ms.). We have 60 subjects, and 28 items.

Let's first load the libraries that we're going to use.

```{r, message=FALSE}
library(tidyverse)
library(lme4)
library(lmerTest)
library(emmeans)
library(performance)
```

Now we're going to read in our data and turn our `subject`, `item`, `context`, and `sentence` columns into factors.

```{r, message=FALSE}
factorial_data <- read_csv("https://raw.githubusercontent.com/ajstewartlang/15_mixed_models_pt1/master/data/2x2.csv")

tidied_factorial_data <- factorial_data %>%
  mutate(subject = factor(Subject), item = factor(Item), RT = RT,
            context = factor(Context), sentence = factor(Sentence))
```

When we generate summary statistics, we encounter the issues of NAs where we expected to see mean values. 

```{r}
tidied_factorial_data %>%
  group_by(context, sentence) %>%
  summarise(mean_rt = mean(RT), sd_rt = sd(RT))
```

This indicates we likely have missing data. R never decides what it should do about missing data - you need to make that decision. Let's use the {visdat} package to investigate...

```{r}
library(visdat)
```

```{r}
vis_miss(tidied_factorial_data)
```

We can calculate how much data RT is missing another way... 

```{r}
tidied_factorial_data %>%
  filter(is.na(RT)) %>%
  count()
```

So we can see we have 12 missing data points. We can filter our cases where we have missing data and re-do our summary statistics.

```{r}
tidied_factorial_data %>%
  filter(!is.na(RT)) %>%
  group_by(context, sentence) %>%
  summarise(mean_rt = mean(RT), sd_rt = sd(RT))
```

Let's visualise the data next. I'm using the `stat_summary()` function to add means and bootstrapped condidence intervals around those means for each of our conditions. I use the syntax `context:sentence` in the `aes()` expression to indicate that I want to plot all combinations of these two factors (i.e., the interactions). I use a few other aesthetic tweaks to make the graph look a little better than the default.

```{r}
tidied_factorial_data %>%
  filter(!is.na(RT)) %>%
  ggplot(aes(x = context:sentence, y = RT, colour = context:sentence)) +
  geom_violin() +
  geom_jitter(width = .1, alpha = .2) +
  stat_summary(fun.data = "mean_cl_boot", colour = "black") +
  guides(colour = FALSE) +
  labs(x = "Context X Sentence",
       y = "RT (ms.)") +
  theme_minimal() +
  coord_flip()
```

# Your Challenge



## Improve this Workshop

If you spot any issues/errors in this workshop, you can raise an issue or create a pull request for [this repo](https://github.com/ajstewartlang/15_mixed_models_pt1). 